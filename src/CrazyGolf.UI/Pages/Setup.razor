@page "/setup"
@using CrazyGolf.UI.Services
@using CrazyGolf.UI.Models
@using MudBlazor
@inject IGameState GameState
@inject NavigationManager NavManager

<div class="neon-wrapper">
    <MudContainer MaxWidth="MaxWidth.Small">
        <MudText Typo="Typo.h4" Align="Align.Center" Class="neon-text-pink mb-6">
            @(_step == 1 ? "GAME CONFIG" : "PLAYER ENTRY")
        </MudText>

        <MudPaper Class="pa-8 rounded-xl neon-card">
            @if (_step == 1)
            {
                <MudText Typo="Typo.h6" Class="mb-6" Style="color: #00f2ff;">Course Settings</MudText>

                <MudNumericField @bind-Value="_holeCount" Label="Number of Holes"
                                 Variant="Variant.Outlined" Min="1" Max="18"
                                 Class="neon-input mb-4" />

                <MudNumericField @bind-Value="_playerCount" Label="Number of Players"
                                 Variant="Variant.Outlined" Min="1" Max="6"
                                 Class="neon-input mb-8" />

                <MudButton Variant="Variant.Filled"
                           Class="neon-btn-green py-3"
                           FullWidth="true"
                           EndIcon="@Icons.Material.Filled.ArrowForward"
                           OnClick="NextStep">
                    Continue
                </MudButton>
            }
            else
            {
                <MudText Typo="Typo.h6" Class="mb-6" Style="color: #00f2ff;">The Roster</MudText>

                @for (int i = 0; i < _playerCount; i++)
                {
                    int index = i;
                    <MudTextField @bind-Value="_playerNames[index]"
                                  Label="@($"Player {index + 1} Name")"
                                  Variant="Variant.Outlined"
                                  Class="neon-input mb-4"
                                  Required="true" />
                }

                <div class="d-flex gap-4 mt-8">
                    <MudButton Variant="Variant.Text"
                               Style="color: #ff00f7;"
                               FullWidth="true"
                               OnClick="() => _step = 1">
                        Back
                    </MudButton>

                    <MudButton Variant="Variant.Filled"
                               Class="neon-btn-green py-3"
                               FullWidth="true"
                               StartIcon="@Icons.Material.Filled.SportsGolf"
                               OnClick="StartGame">
                        Tee Off!
                    </MudButton>
                </div>
            }
        </MudPaper>
    </MudContainer>
</div>

@code {
    private int _step = 1;
    private int _holeCount = 9;
    private int _playerCount = 2;
    private List<string> _playerNames = new();

    private void NextStep()
    {
        // Initialize or adjust the names list based on player count
        if (_playerNames.Count < _playerCount)
        {
            for (int i = _playerNames.Count; i < _playerCount; i++)
                _playerNames.Add($"Player {i + 1}");
        }
        else if (_playerNames.Count > _playerCount)
        {
            _playerNames = _playerNames.Take(_playerCount).ToList();
        }

        _step = 2;
    }

    private async Task StartGame()
    {
        // 1. Tell the brain to create the game
        await GameState.InitializeGameAsync(_holeCount, _playerNames);

        // 2. Head over to the scorecard!
        NavManager.NavigateTo("/play");
    }
}